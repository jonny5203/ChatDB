# Story: 5.2 - S3 Integration for Model Storage

**Epic:** 5 - Model Registry Implementation
Status: Ready for Review

## Story

As a developer, I want to integrate AWS S3 for model storage in the Model Registry service, so that trained models can be uploaded, stored, and retrieved securely.

## Acceptance Criteria

1.  The service can upload a file to a specified S3 bucket.
2.  The service can download a file from a specified S3 bucket.
3.  S3 credentials are not hardcoded and are managed securely (e.g., via environment variables or IAM roles).
4.  The implementation uses the `boto3` library for all S3 interactions.
5.  Unit and integration tests are created to validate the S3 upload and download functionality.

## Dev Notes

*   **Frameworks**: Continue using Python and the FastAPI framework. [Source: docs/architecture/coding-standards.md]
*   **AWS SDK**: Use the `boto3` library for interacting with AWS S3.
*   **Configuration**: The S3 bucket name and AWS region should be configurable via environment variables.
*   **Authentication**: The service should be designed to use IAM roles for authentication to S3 when deployed. For local development and testing, AWS access keys can be configured via environment variables.
*   **Testing**: Use the `moto` library to mock AWS services, including S3, for both unit and integration tests. This avoids the need for real AWS credentials during the test cycle. [Source: docs/architecture/testing-strategy.md]

## Tasks / Subtasks

*   [x] Add `boto3` and `moto` to the `Pipfile`. (Already present in root Pipfile)
*   [x] Create a new `S3Service` class to encapsulate all S3-related logic.
*   [x] Implement an `upload_file` method in `S3Service` that takes a file and an S3 key and uploads it to the configured bucket.
*   [x] Implement a `download_file` method in `S3Service` that takes an S3 key and returns the file content.
*   [x] Create a new `ModelController` with endpoints for uploading and downloading models (e.g., `POST /models` and `GET /models/{model_id}`).
*   [x] Write unit tests for the `S3Service` using `moto` to mock the S3 backend.
*   [x] Write integration tests for the `ModelController` that use `moto` to verify the complete upload and download workflow.

## Dev Agent Record

### File List
- Pipfile
- model-registry/services/s3_service.py
- model-registry/routers/model_router.py
- model-registry/tests/test_s3_service.py
- model-registry/tests/test_model_router.py

## QA Results

- **Code Review:** The code is well-structured, follows project conventions, and effectively implements the required functionality.
- **Testing:** All unit and integration tests pass successfully. The tests provide good coverage of the new S3 integration.
- **Conclusion:** The story meets all acceptance criteria and is approved from a QA perspective.

## Change Log

| Date       | Version | Description     | Author             |
| :---       | :---    | :---            | :---               |
| 2025-08-11 | 1.0     | Initial Draft   | Bob (Scrum Master) |
| 2025-08-12 | 1.1     | QA Review Pass  | Quinn (QA)         |
| 2025-08-12 | 1.2     | PO Validation   | Sarah (PO)         |
